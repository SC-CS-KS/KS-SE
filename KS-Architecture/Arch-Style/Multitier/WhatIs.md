# What Is Multitier Architecture

## 分层的本质
```md
把一系列相同或相似的对象进行分类并放在同一层，然后 根据他们之间的依赖关系再确定上下层次关系。
```
```md
分层的核心在于 分类 和 关联(事物的两面性： 区别和联系)
分类：确定 划分标准，将相关对象进行 抽象（分离变与不变，提取共同点）并归类，对层之间进行 隔离，并保持层内元素是高度 内聚
关联：层与层以及外部是存在联系的，需要关注不同层间的 依赖与通信，保持层间的 松散耦
```
## 目标
* 分层就是达到高内聚低耦合的手段之一
```md
高内聚(同一层): 单一职责
低耦合(层与层之间): 每层只能依赖于同层以及其下层，每层以接口方式供上层调用
```
## 原则
```md
原则其实可以看做一种 高层指导规范，可以帮助避免一些常见的坑或者帮助更好的实施以得到更好的效果。
关注点分离（Separation of Concerns）: 使设计中每个部分都得到单独的关注，在分离的同事，也需要维持系统内部复杂的交互关系
最少知识原则(Least Knowledge Principle/Law of Demeter)
```
## 约束
* 按照层次来进行组织，每个层都有特定的责任
* 每一层为在其之上的层提供服务，并且使用在其之下的层所提供的服务
* 较低层不可使用较高层中的服务
* 一般不跨层调用

## 优缺点
```md
分层架构风格使得组件高内聚、低耦合，每个组件能独立进化，提高了架构的「伸缩性」
组件层面代码隔离，提高了「可维护性」
层与层之间调用限制，可方便的替换对应的层，方便了「组件复用」以及「可移植性」
```
```md
由于一个请求可能需要经过多层来处理，层与层之间的通信会影响到「性能」！
```

## 风格
```md
严格分层(Strict Layers Architecture): 
	只能访问同层和直接下层； 降低了层之间的耦合性，对低层的修改不会对整个系统造成广泛的影响，但可能造成 无意义的代码；
灵活分层(Relaxed Layers Architecture): 
	允许访问同层和所有下层；无需引入过多的请求，性能相对较高，缺点是可能造成 混乱
```

## How
```md
好的分层应该满足一下几点：
	层级分明，职责分明
	链路清晰，避免环形调用
	良好的抽象和复用
	业务接口足够独立，一个接口的修改不会影响其他功能
```
* 对于层次间依赖，是否允许第N层直接访问第N-2、N-3…层？
```md
虽然DDD推荐灵活的分层模式，但是这种做法在实际工程中这个比较容易造成混乱和难以管理。
所以一般实践可能会 首先使用严格的分层，当某层的大多数代码基本没有任何业务逻辑（即污水池反模式）时，才考虑重构并开放该层。
```
* 怎么处理分层和分割的关系？
```md
分层是一种 横向 的切割，而分割（划分模块）是一种基于功能上的 纵向 切割。
在划分package时，我们常常能看到两种做法，一种是每层作为一个包名（如domain，dao等），里面放置各个对应的功能。
另外一种就是以功能来作为包名，里面包含各种实现。
```
```md
一般推荐 先按功能进行划分模块，然后模块里面再进行进行分层。
功能相对内聚，层次也比较清晰，同时也利于后续的拆分或者微服务化。
```
```md
在纵向分割时，同样存在一些不同的视角（例如物流业务可以按海运、陆运、空运、快递等业务来划分模块，
也可以按方案查询、下单、跟单、结算等来划分模块），需要架构师根据变化性以及共同点等去进行权衡。
```